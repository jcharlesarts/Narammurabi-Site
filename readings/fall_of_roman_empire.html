<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Downfall of Rome — Chunked Reading</title>
  <style>
    :root{
      --bg:#0f172a;        /* slate-900 */
      --card:#111827;      /* gray-900 */
      --ink:#e5e7eb;       /* gray-200 */
      --muted:#cbd5e1;     /* slate-300 */
      --accent:#38bdf8;    /* sky-400 */
      --accent2:#a78bfa;   /* violet-400 */
      --good:#34d399;      /* emerald-400 */
      --warn:#fbbf24;      /* amber-400 */
      --bad:#fb7185;       /* rose-400 */
      --line: rgba(255,255,255,.12);
    }

    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1100px 700px at 15% 10%, rgba(56,189,248,.14), transparent 60%),
                  radial-gradient(1100px 700px at 85% 20%, rgba(167,139,250,.14), transparent 55%),
                  var(--bg);
      color: var(--ink);
      line-height: 1.45;
    }

    header{
      padding: 18px 18px 10px;
      max-width: 980px;
      margin: 0 auto;
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:flex-end;
      justify-content:space-between;
    }
    header h1{
      margin:0;
      font-size: 1.2rem;
      letter-spacing:.2px;
    }
    header .sub{
      margin: 2px 0 0;
      color: var(--muted);
      font-size:.95rem;
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 12px 18px 26px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
    }

    .card{
      background: rgba(17,24,39,.86);
      border: 1px solid var(--line);
      border-radius: 14px;
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
      padding: 16px;
    }

    .chunk-title{
      display:flex;
      gap:10px;
      align-items:center;
      margin: 0 0 8px;
    }
    .pill{
      font-size:.82rem;
      padding: 4px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      white-space:nowrap;
    }
    .pill.accent{ color: var(--accent); border-color: rgba(56,189,248,.35); }
    .pill.violet{ color: var(--accent2); border-color: rgba(167,139,250,.35); }
    .pill.good{ color: var(--good); border-color: rgba(52,211,153,.35); }
    .pill.warn{ color: var(--warn); border-color: rgba(251,191,36,.35); }

    .chunk h2{
      margin:0;
      font-size: 1.05rem;
    }
    .chunk p{
      margin: 10px 0 0;
      font-size: 1rem;
    }

    /* Accessibility: reading font size (LEFT card only) */
    .chunk.reading-sm #chunkBody { font-size: 0.98rem; }
    .chunk.reading-md #chunkBody { font-size: 1.05rem; }
    .chunk.reading-lg #chunkBody { font-size: 1.15rem; }
    .chunk.reading-xl #chunkBody { font-size: 1.28rem; }

    .chunk.reading-sm #chunkBody p,
    .chunk.reading-sm #chunkBody li { font-size: 0.98rem; }

    .chunk.reading-md #chunkBody p,
    .chunk.reading-md #chunkBody li { font-size: 1.05rem; }

    .chunk.reading-lg #chunkBody p,
    .chunk.reading-lg #chunkBody li { font-size: 1.15rem; }

    .chunk.reading-xl #chunkBody p,
    .chunk.reading-xl #chunkBody li { font-size: 1.28rem; }

    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top: 14px;
      align-items:center;
      justify-content:space-between;
    }

    button{
      appearance:none;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--ink);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 650;
      letter-spacing:.2px;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
    }
    button:hover{
      background: rgba(255,255,255,.09);
      border-color: rgba(255,255,255,.22);
    }
    button:active{ transform: translateY(1px); }

    .btn-primary{
      border-color: rgba(56,189,248,.35);
      background: rgba(56,189,248,.12);
    }
    .btn-primary:hover{ background: rgba(56,189,248,.16); }

    .btn-secondary{
      border-color: rgba(167,139,250,.35);
      background: rgba(167,139,250,.12);
    }
    .btn-secondary:hover{ background: rgba(167,139,250,.16); }

    .btn-hint{
      border-color: rgba(251,191,36,.35);
      background: rgba(251,191,36,.10);
    }
    .btn-hint:hover{ background: rgba(251,191,36,.14); }

    .progress{
      font-size: .92rem;
      color: var(--muted);
    }

    /* Right side */
    .panel h3{ margin:0 0 8px; font-size: 1rem; }
    .panel .box{
      background: rgba(255,255,255,.04);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
      margin-top: 10px;
    }

    .next-task{
      border-left: 4px solid rgba(56,189,248,.6);
    }
    .next-task strong{ color: var(--accent); }

    .hints{
      border-left: 4px solid rgba(251,191,36,.7);
      display:none;
    }
    .hints strong{ color: var(--warn); }

    .rules{
      border-left: 4px solid rgba(52,211,153,.6);
    }
    .rules strong{ color: var(--good); }

    /* Vocab */
    .vocab{
      color: var(--accent);
      font-weight: 750;
      cursor: pointer;
      border-bottom: 1px dotted rgba(56,189,248,.7);
      padding: 0 2px;
      border-radius: 6px;
      transition: background .15s ease, box-shadow .15s ease, transform .05s ease;
    }
    .vocab:hover{
      background: rgba(56,189,248,.12);
    }
    .vocab:active{
      transform: translateY(1px);
    }
    /* “Just clicked” highlight (keyboard + mouse friendly) */
    .vocab:focus{
      outline: none;
    }
    .vocab.vocab-active{
      background: rgba(56,189,248,.18);
      box-shadow: 0 0 0 2px rgba(56,189,248,.35);
    }

    /* Modal */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 50;
    }
    .modal{
      max-width: 560px;
      width: 100%;
      background: rgba(17,24,39,.96);
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: 0 20px 50px rgba(0,0,0,.45);
      padding: 16px 16px 12px;
    }
    .modal h4{ margin:0 0 6px; font-size: 1.05rem; }
    .modal p{ margin:0 0 12px; color: var(--muted); }
    .modal .row{
      display:flex; justify-content:flex-end;
    }

    @media (max-width: 880px){
      .wrap{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
<header>
  <div>
    <h1>Downfall of Rome — Reading Assignment</h1>
    <div class="sub">Read each section, and then → answer the matching worksheet prompt → click Next.</div>
  </div>
  <div class="progress" id="progressText">Chunk 1 of 6</div>
</header>

<main class="wrap">
  <!-- LEFT: Reading chunk -->
  <section class="card chunk" aria-live="polite">
    <div class="chunk-title">
      <span class="pill accent" id="unitTag">Unit: Rome</span>
      <span class="pill violet" id="chunkTag">Chunk</span>
      <span class="pill" id="skillTag">Skill: Evidence</span>
    </div>

    <h2 id="chunkTitle">Welcome</h2>
    <div id="chunkBody"></div>

    <div class="controls">
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn-secondary" id="btnPrev" type="button">← Back</button>
        <button class="btn-primary" id="btnNext" type="button">Next →</button>
      </div>
      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
        <button class="btn-hint" id="btnHint" type="button">Hint</button>
        <button id="btnVocab" type="button">Vocab List</button>
        <span style="width:1px; height:22px; background: var(--line); display:inline-block;"></span>
        <span style="color:var(--muted); font-size:.92rem;">Reading size:</span>
        <button id="btnFontSm" type="button" aria-label="Smaller reading text">A-</button>
        <button id="btnFontMd" type="button" aria-label="Default reading text">A</button>
        <button id="btnFontLg" type="button" aria-label="Larger reading text">A+</button>
        <button id="btnFontXl" type="button" aria-label="Extra large reading text">A++</button>
      </div>
    </div>
  </section>

  <!-- RIGHT: worksheet directions + hints -->
  <aside class="card panel">
    <h3>Worksheet Checkpoint</h3>

    <div class="box rules">
      <strong>Rules</strong>
      <div style="color:var(--muted); margin-top:6px;">
        <div>✅ Every answer should match the reading.</div>
        <div>✅ Use <b>evidence</b> (4–6 words copied from the reading).</div>
        <div>✅ If stuck: re-read → ask partner → raise hand.</div>
      </div>
    </div>

    <div class="box next-task" id="nextTaskBox">
      <strong>After reading, do this now:</strong>
      <div id="nextTaskText" style="color:var(--muted); margin-top:6px;">
        Read the directions, then click Next.
      </div>
    </div>

    <div class="box hints" id="hintsBox">
      <strong>Hint</strong>
      <div id="hintsText" style="color:var(--muted); margin-top:6px;"></div>
    </div>

    <div class="box">
      <strong>Targets on today’s worksheet</strong>
      <div style="color:var(--muted); margin-top:6px;">
        <div>• Main idea for Issue #1, #2, #3</div>
        <div>• Issue #3 sentence stem + evidence</div>
        <div>• Cause → Effect matching</div>
        <div>• Show Your Understanding (inflation, barter, army)</div>
        <div>• Biggest issue (your opinion)</div>
      </div>
    </div>
  </aside>
</main>

<!-- Modal for vocab -->
<div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-label="Vocabulary definition">
  <div class="modal">
    <h4 id="modalTitle">Vocabulary</h4>
    <p id="modalText"></p>
    <div class="row">
      <button id="modalClose" type="button">Close</button>
    </div>
  </div>
</div>

<script>
  // --- Vocab bank (clickable words) ---
  const VOCAB = {
    "unstable": "Not steady. Things change a lot or feel unsafe.",
    "corrupt": "Dishonest leaders who use power unfairly (often for money).",
    "civil war": "A war between groups inside the same country.",
    "Pax Romana": "A long period of peace and prosperity in Rome (about 200 years).",
    "bribe": "Money paid to influence someone in power to do what you want.",
    "loyal": "Faithful. Sticks with a person or group.",
    "invaders": "Attackers from outside the empire.",
    "inflation": "Prices rise because money is worth less.",
    "barter": "Trade goods/services instead of using money.",
    "emperor": "The all-powerful ruler of an empire.",
    "wages": "Pay (money) for work."
  };

  // Wrap vocab words in spans so they can be clicked.
  function vocabify(text){
    // Order matters: longer phrases first
    const keys = Object.keys(VOCAB).sort((a,b)=>b.length-a.length);
    let out = text;
    keys.forEach(k=>{
      const safe = k.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      const re = new RegExp(`\\b${safe}\\b`, "gi");
      out = out.replace(re, (match)=>`<span class="vocab" data-vocab="${k.toLowerCase()}">${match}</span>`);
    });
    return out;
  }

  // --- Reading chunks (6 total) ---
  // Chunks 2-4: pulled directly from your “Fall of the Empire — 3 Issues” reading.
  // Chunk 5: pulled from “Rome’s Declining Economy.”
  const CHUNKS = [
    {
      tag: "Directions",
      skill: "How to use this",
      title: "How to use this reading page",
      body: `
        <p><b>Goal:</b> Read one chunk at a time and answer the matching part of your worksheet.</p>
        <p><b>How to be successful:</b></p>
        <ol style="margin:6px 0 0 22px; padding-left: 18px; color: var(--muted);">
          <li>Read the section.</li>
          <li>Answer the worksheet prompt shown on the right.</li>
          <li>Use an evidence phrase (4–6 words) from the text.</li>
          <li>Click <b>Next</b>.</li>
        </ol>
        <p>Click any <span class="vocab" data-vocab="inflation">vocab</span> word for a definition.</p>
      `,
      nextTask: `On your worksheet: read the Directions and get your pencil ready.`,
      hint: `If you don’t remember the vocab words, click them in the reading.`,
    },

    {
      tag: "Issue #1",
      skill: "Main idea",
      title: "Issue #1 — Weak Government / Instability",
      body: `
        <p>${vocabify(
          "The fall of Rome began with a weakened government. Poor and corrupt leadership caused the Roman Empire to once again become unstable. This led to many other problems. Julius Caesar was Rome’s first dictator, and his reforms made a long-lasting impact on Rome. After his assassination, his adopted son, Augustus took control of the Empire. He led Rome into a 200-year long period of peace and prosperity, called the Pax Romana. After the Pax Romana, Rome experienced Civil wars for about 100 years, and that weakened the government."
        )}</p>
      `,
      nextTask: `Worksheet: <b>Issue #1 Main Idea</b> — “The Roman Empire became weaker because _____.” Then add: “This matters because _____.”`,
      hint: `Look for the sentence that explains the main problem (weak government / corrupt leadership / unstable).`,
    },

    {
      tag: "Issue #2",
      skill: "Main idea",
      title: "Issue #2 — Military Problems + Invasions",
      body: `
        <p>${vocabify(
          "During this time, other things started to weaken the Roman Empire. Rome’s emperor’s bribed soldiers to be loyal, but when they could no longer pay, the soldiers would not continue to fight for Rome. With less money to use, the government started to hire Germanic soldiers, however, they had no loyalty to the empire. As a result, Rome experienced many attacks from foreign invaders. Those attacks interrupted trade and caused problems for Rome’s economy. These attacks led to food shortages, and food prices were raised."
        )}</p>
      `,
      nextTask: `Worksheet: <b>Issue #2 Main Idea</b> — “Rome struggled to defend itself because _____.”`,
      hint: `Underline a phrase about soldiers not fighting, loyalty, hiring outside soldiers, and invaders.`,
    },

    {
      tag: "Issue #3",
      skill: "Cause → effect + vocab",
      title: "Issue #3 — Economic Decline (Inflation + Barter)",
      body: `
        <p>${vocabify(
          "Farmers and Merchants raised their prices so they could make a profit ($) again. Rome continued to create more coined money, which made the value of the coins go down. This is called inflation. People had less money to spend, so they bought fewer goods. Merchants saw their profits decline, and many workers lost their jobs. This left merchants and farmers without food or money. As a result, people in Rome started to barter instead of use coined money. Rome’s economy continued to decline."
        )}</p>
      `,
      nextTask: `Worksheet: <b>Issue #3 Main Idea</b> + choose ONE <b>Issue #3 sentence stem</b>. Then add an evidence quote (4–6 words).`,
      hint: `Inflation = coins worth less. Barter = trade goods instead of money. Use that for your sentence stem.`,
    },

    {
      tag: "Economy Details",
      skill: "Evidence hunt",
      title: "Rome’s Declining Economy — More Details",
      body: `
        <p>${vocabify(
          "Marcus Aurelius was the last of the five emperors who reigned during the Pax Romana. Nearly a century of confusion and violence followed his reign. During this time, Rome’s government grew weak, while the army became very powerful. To stay in office, an emperor had to pay increasingly higher wages to the soldiers. When these payments could not be made, soldiers would turn against the emperor. In a span of about 50 years, Rome had 22 different emperors. Most were murdered by the army or by their bodyguards."
        )}</p>
        <p>${vocabify(
          "Roman society suffered during this period. Corrupt government officials took bribes, this means that people could pay the government officials to do what they wanted. Wealthy Romans stopped paying taxes so the government ran out of money. When the government ran out of gold coins they tried to make more using less valuable metals. These problems lead to inflation and the value of Roman coins decreases. Many Romans no longer honored the traditional values of duty, courage, and honesty."
        )}</p>
      `,
      nextTask: `Worksheet: Answer the “Show Your Understanding” section: inflation, barter, and one reason the army became less effective.`,
      hint: `For “army less effective,” look for: soldiers stopped fighting, loyalty problems, hired Germanic soldiers, invaders.`,
    },

    {
      tag: "Wrap-Up",
      skill: "Systems thinking",
      title: "Put it together: Cause → Effect",
      body: `
        <p><b>Now connect the problems.</b> Rome didn't have just one problem. It had many problems that were connected. This created was a chain reaction.</p>
        <p>Weak government → army problems → invasions → trade problems → inflation → barter → economy declines.</p>
        <p><b>Finish strong:</b> choose what you think was the biggest issue and explain why (one sentence).</p>
      `,
      nextTask: `Worksheet: Do the <b>Cause → Effect matching</b>, then the <b>Biggest Issue</b> opinion sentence.`,
      hint: `If you’re stuck on matching: ask “What happens next?” (trade disrupted → shortages → prices rise → barter).`,
    }
  ];

  // --- UI State ---
  let idx = 0;

  const elTitle = document.getElementById("chunkTitle");
  const elBody  = document.getElementById("chunkBody");
  const elProgress = document.getElementById("progressText");
  const elChunkTag = document.getElementById("chunkTag");
  const elSkillTag = document.getElementById("skillTag");
  const elNextTaskText = document.getElementById("nextTaskText");
  const elHintsBox = document.getElementById("hintsBox");
  const elHintsText = document.getElementById("hintsText");

  const btnPrev = document.getElementById("btnPrev");
  const btnNext = document.getElementById("btnNext");
  const btnHint = document.getElementById("btnHint");
  const btnVocab = document.getElementById("btnVocab");
  const btnFontSm = document.getElementById("btnFontSm");
  const btnFontMd = document.getElementById("btnFontMd");
  const btnFontLg = document.getElementById("btnFontLg");
  const btnFontXl = document.getElementById("btnFontXl");

  // Modal
  const backdrop = document.getElementById("modalBackdrop");
  const modalTitle = document.getElementById("modalTitle");
  const modalText  = document.getElementById("modalText");
  const modalClose = document.getElementById("modalClose");

  function render(){
    const c = CHUNKS[idx];
    elTitle.textContent = c.title;
    elBody.innerHTML = c.body;
    elProgress.textContent = `Chunk ${idx+1} of ${CHUNKS.length}`;
    elChunkTag.textContent = c.tag;
    elSkillTag.textContent = `Skill: ${c.skill}`;
    elNextTaskText.innerHTML = c.nextTask;

    // Hide hints by default each chunk
    elHintsBox.style.display = "none";
    elHintsText.textContent = c.hint || "";

    // Buttons
    btnPrev.disabled = (idx === 0);
    btnNext.disabled = (idx === CHUNKS.length - 1);

    // Attach vocab click listeners
    document.querySelectorAll(".vocab").forEach(span=>{
      // Make focusable for accessibility
      span.setAttribute("tabindex", "0");

      const activate = ()=>{
        // Clear any prior highlights in this chunk
        document.querySelectorAll(".vocab.vocab-active").forEach(el=>el.classList.remove("vocab-active"));

        // Highlight this word briefly
        span.classList.add("vocab-active");
        setTimeout(()=> span.classList.remove("vocab-active"), 650);

        const key = (span.getAttribute("data-vocab") || "").toLowerCase();
        showVocab(key, span.textContent);
      };

      span.addEventListener("click", activate);
      span.addEventListener("keydown", (e)=>{
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          activate();
        }
      });
    });
  }

  // --- Reading font size controls (LEFT reading only) ---
  const SIZE_CLASS = {
    sm: "reading-sm",
    md: "reading-md",
    lg: "reading-lg",
    xl: "reading-xl"
  };

  function setReadingSize(size){
    const chunkEl = document.querySelector("section.card.chunk");
    if(!chunkEl) return;

    // Remove existing size classes
    Object.values(SIZE_CLASS).forEach(cls => chunkEl.classList.remove(cls));

    // Apply new size
    const cls = SIZE_CLASS[size] || SIZE_CLASS.md;
    chunkEl.classList.add(cls);

    // Save
    try { localStorage.setItem("romeReadingSize", size); } catch(e) {}
  }

  function loadReadingSize(){
    let size = "md";
    try { size = localStorage.getItem("romeReadingSize") || "md"; } catch(e) {}
    setReadingSize(size);
  }

  function showVocab(key, displayWord){
    const def = VOCAB[key] || VOCAB[displayWord.toLowerCase()] || "Definition not found.";
    modalTitle.textContent = displayWord;
    modalText.textContent = def;
    modalText.style.whiteSpace = "normal";
    backdrop.style.display = "flex";
  }

  function closeModal(){ backdrop.style.display = "none"; }

  btnPrev.addEventListener("click", ()=>{ if(idx>0){ idx--; render(); } });
  btnNext.addEventListener("click", ()=>{ if(idx<CHUNKS.length-1){ idx++; render(); } });

  btnHint.addEventListener("click", ()=>{
    const c = CHUNKS[idx];
    elHintsText.textContent = c.hint || "Re-read the chunk and look for key vocabulary words.";
    elHintsBox.style.display = (elHintsBox.style.display === "none") ? "block" : "none";
  });

  btnVocab.addEventListener("click", ()=>{
    // Quick vocab list modal
    modalTitle.textContent = "Vocab List";
    modalText.innerHTML = Object.entries(VOCAB)
      .map(([k,v])=>`<div>• <b>${k.toUpperCase()}</b> - ${v}</div>`)
      .join("");
    modalText.style.whiteSpace = "normal";
    backdrop.style.display = "flex";
  });

  btnFontSm.addEventListener("click", ()=> setReadingSize("sm"));
  btnFontMd.addEventListener("click", ()=> setReadingSize("md"));
  btnFontLg.addEventListener("click", ()=> setReadingSize("lg"));
  btnFontXl.addEventListener("click", ()=> setReadingSize("xl"));

  backdrop.addEventListener("click", (e)=>{ if(e.target === backdrop) closeModal(); });
  modalClose.addEventListener("click", closeModal);
  window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

  // Initial render
  render();
  loadReadingSize();
</script>
</body>
</html>
